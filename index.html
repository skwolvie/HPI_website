<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Graph from CSV</title>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>

		<section>
			<header>
				<a href="#"><img src="logo.png" class="logo"></a>
				<ul>
					<li><a href="#">Home</a></li>
					<li><a href="#">Methodology</a></li>
					<li><a href="#">About Us</a></li>
				</ul>
			</header>

			<div class="content">
				<div class="textBox">
					<h2>Economic Policy Uncertainty Index</h2>
					<p>We develop indices of economic policy uncertainty for countries around the world.</p>
				</div>
				<ul>
					<li><a href="#">tab 1</a></li>
					<li><a href="#">tab 2</a></li>
					<li><a href="#">tab 3</a></li>
				</ul>
			</div>
		</section>


		<div style="width:800px;height:400px">
			<canvas id="chart" width="800" height="400"></canvas>
		</div>
		<script>
			const xlabels = [];
			const ydata = [];
			chartIt();

			async function chartIt(){
				await getData();
				const ctx = document.getElementById('chart').getContext('2d');
				const chart = new Chart(ctx, {
				    // The type of chart we want to create
				    type: 'line',
				    responsive:true,

				    // The data for our dataset
				    data: {
				        labels: xlabels,
				        datasets: [{
				            label: 'Economic Policy Uncertainty',
				            fill: false,
				            lineTension: 0.1,
				            backgroundColor: 'rgb(255, 99, 132)',
				            borderColor: 'rgb(255, 99, 132)',
				            borderWidth: 1,
				            data: ydata
				        }]
				    },

				    // Configuration options go here
				    options: {
				        scales: {
				            yAxes: [{
				                ticks: {
				                    // Include a dollar sign in the ticks
				                    callback: function(value, index, values) {
				                        return '$' + value;
				                    }
				                }
				            }]
				        },

				        animation: {
				        	duration : 1000,
				        	easing : 'linear',
				            onProgress: function(animation) {
				                console.log(animation.animationObject.currentStep / animation.animationObject.numSteps);
				            }
				        },

				        layout: {
				            padding: {
				                left: 50,
				                right: 0,
				                top: 0,
				                bottom: 50
				            }
				        }
				    }
				});
			}

			async function getData() {
				const response = await fetch('spanish-silver.csv');
				const data = await response.text();

				const table = data.split('\n').slice(1);
				table.forEach(row => {
					const columns = row.split(',');
					const year = columns[0];
					xlabels.push(year);
					const silver = columns[2];
					ydata.push(silver);
					console.log(year,silver);
				});
			}
		</script>
	</body>
</html>